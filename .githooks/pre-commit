#!/bin/bash

# SHIBUYA: Sicherheits-Check fÃ¼r Klartext-Notizen
if [ -d "mokuroku/notes" ]; then
    echo -e "\x1b[33mðŸ”’ SHIBUYA: Offener Tresor erkannt. Starte Versiegelung...\x1b[0m"

    # 1. Den Tresor-Befehl ausfÃ¼hren (erzeugt vault, lÃ¶scht Klartext)
    node ./shibuya/mokuroku.mjs lock

    # 2. Die neue Vault-Datei automatisch stagen
    git add mokuroku/notes.vault

    # 3. Den aktuellen Commit-Versuch abbrechen
    echo -e "\x1b[32mâœ… Tresor wurde versiegelt und 'notes.vault' gestaged.\x1b[0m"
    echo -e "\x1b[31mâœ‹ Commit abgebrochen, um Konsistenz zu wahren.\x1b[0m"
    echo -e "Bitte fÃ¼hre deinen Commit-Befehl jetzt erneut aus (Pfeil-oben + Enter)."
    exit 1
fi

exit 0
